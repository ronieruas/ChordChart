<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChordChart Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chord-output, .lyric-output, .summary-chord { font-family: 'Roboto Mono', monospace; line-height: 1.6; white-space: pre; }
        .chord-output, .summary-chord { font-weight: 700; }
        #outputArea { transition: column-count 0.3s ease-in-out; }
        .output-container.two-columns { column-count: 2; column-gap: 2.5rem; }
        .section-container { break-inside: avoid; }
        #view-wrapper { transition: all 0.3s ease-in-out; border: 1px solid #e5e7eb; margin: auto; }
        .view-tablet { width: 768px; }
        .view-mobile { width: 425px; }
        body:has(.fullscreen-view) { background-color: white !important; }
        .fullscreen-view { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: white; overflow-y: auto; z-index: 9999; padding: 2rem; }
        dialog::backdrop { background: rgba(0, 0, 0, 0.5); }
        .hidden { display: none; }
        [x-cloak] { display: none !important; }
        .tab-btn.active { border-color: #3b82f6; background-color: #dbeafe; color: #1e40af; }
        @media print { .no-print { display: none !important; } body { background-color: white !important; margin: 0; padding: 0; } main { padding: 0 !important; } #view-wrapper { width: 100% !important; border: none !important; box-shadow: none !important; padding: 1cm !important; } #outputArea { padding: 0 !important; box-shadow: none !important; border: none !important; } .output-container.two-columns { column-count: 2 !important; } h2, h3 { color: black !important; } .chord-output, .summary-chord { color: #1e40af !important; } .lyric-output { color: #111827 !important; } }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-100">

    <!-- Tela de Login -->
    <div id="login-container" class="flex items-center justify-center min-h-screen bg-gray-100">
        <!-- Login Form... -->
        <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-center text-gray-800">Login - ChordChart Pro</h2>
            <form id="login-form"><div class="space-y-4"><div><label for="username" class="text-sm font-medium text-gray-700">Usuário</label><input id="username" name="username" type="text" required class="w-full p-2 mt-1 border border-gray-300 rounded-md shadow-sm"></div><div><label for="password" class="text-sm font-medium text-gray-700">Senha</label><input id="password" name="password" type="password" required class="w-full p-2 mt-1 border border-gray-300 rounded-md shadow-sm"></div></div><p id="login-error" class="text-sm text-red-600 mt-2 hidden">Usuário ou senha inválidos.</p><button type="submit" class="w-full px-4 py-2 mt-6 font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700">Entrar</button></form>
        </div>
    </div>

    <!-- Container Principal da Aplicação -->
    <div id="app-container" class="hidden flex-col lg:flex-row min-h-screen">
        <aside class="w-full lg:w-96 bg-white p-6 shadow-lg lg:h-screen lg:sticky lg:top-0 overflow-y-auto no-print">
            <div class="flex justify-between items-center"><h1 class="text-2xl font-bold text-blue-700">ChordChart Pro</h1><div x-data="{ open: false }" class="relative"><button @click="open = !open" class="p-2 text-gray-600 hover:text-blue-700 focus:outline-none"><i class="fas fa-bars"></i></button><div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-20"><a href="#" id="change-password-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Alterar Senha</a><a href="#" id="manage-users-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hidden">Gerenciar Usuários</a><a href="#" id="manage-setlists-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Gerenciar Set Lists</a><a href="#" onclick="window.print()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Imprimir / PDF</a><hr><a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Sair</a></div></div></div>
            <div class="flex justify-between items-center mt-2"><span id="welcome-user" class="text-sm text-gray-600"></span><button id="fullscreen-btn" class="p-1 text-gray-500 hover:text-blue-600" title="Tela Cheia"><i class="fas fa-expand"></i></button></div><hr class="my-4">
            <div class="mb-4"><div class="flex justify-between items-center mb-1"><label for="songInput" class="block text-sm font-medium text-gray-700">Cifra Atual:</label><button id="clear-input-btn" class="text-xs text-gray-400 hover:text-red-500" title="Limpar"><i class="fas fa-times-circle"></i> Limpar</button></div><textarea id="songInput" rows="8" class="w-full p-2 border border-gray-300 rounded-md shadow-sm text-sm" placeholder="[Intro]&#10;G D Em C&#10;..."></textarea><div class="flex gap-2 mt-2"><button id="generateButton" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-sm">Gerar</button><button id="saveButton" class="flex-1 bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-md shadow-sm">Salvar</button></div></div>
            <button id="open-songs-btn" class="w-full bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded-md shadow-sm mb-4">Abrir Músicas Salvas</button>
            <div class="space-y-6">
                 <div><h3 class="font-semibold text-gray-800 mb-2">Tom da Música</h3><div class="flex items-center justify-center gap-4 bg-gray-50 p-3 rounded-md"><button id="transpose-down" class="px-3 py-1 bg-gray-300 rounded-md text-lg font-bold">-</button><div class="text-center"><span id="transpose-status" class="font-bold text-lg text-blue-600">Original</span></div><button id="transpose-up" class="px-3 py-1 bg-gray-300 rounded-md text-lg font-bold">+</button></div></div>
                 <div><h3 class="font-semibold text-gray-800 mb-2">Formatação da Cifra</h3><div class="space-y-3 bg-gray-50 p-3 rounded-md"><div class="flex items-center justify-between"><label for="lyrics-size" class="text-sm">Letra:</label><input id="lyrics-size" type="range" min="10" max="32" value="16" class="w-2/3"><input id="lyrics-color" type="color" value="#374151" class="w-8 h-8 p-0 border-none rounded"></div><div class="flex items-center justify-between"><label for="chords-size" class="text-sm">Acordes:</label><input id="chords-size" type="range" min="10" max="32" value="16" class="w-2/3"><input id="chords-color" type="color" value="#2563eb" class="w-8 h-8 p-0 border-none rounded"></div></div></div>
                 <div><h3 class="font-semibold text-gray-800 mb-2">Layout e Visualização</h3><div class="grid grid-cols-2 gap-2 bg-gray-50 p-3 rounded-md"><button id="view-mode-toggle" class="bg-gray-200 py-2 rounded-md text-sm">Ver Mapa</button><button id="columns-toggle" class="bg-gray-200 py-2 rounded-md text-sm">Usar 2 Colunas</button></div><div class="flex justify-center gap-2 mt-2 bg-gray-50 p-3 rounded-md"><button data-view="desktop" class="view-toggle-btn p-2 text-gray-500 hover:text-blue-600" title="Desktop"><i class="fas fa-desktop"></i></button><button data-view="tablet" class="view-toggle-btn p-2 text-gray-500 hover:text-blue-600" title="Tablet"><i class="fas fa-tablet-alt"></i></button><button data-view="mobile" class="view-toggle-btn p-2 text-gray-500 hover:text-blue-600" title="Mobile"><i class="fas fa-mobile-alt"></i></button></div></div>
            </div>
        </aside>
        <main class="flex-1 p-4 sm:p-8 bg-gray-100">
            <div id="view-wrapper" class="bg-white p-8 rounded-lg shadow-inner min-h-full">
                <div id="outputArea" class="output-container"></div>
                <div id="summaryArea" class="mt-8"></div>
                <div id="uniqueChordsArea" class="mt-8"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <dialog id="save-modal" class="p-6 rounded-lg shadow-xl border w-full max-w-md"><h3 class="text-lg font-bold mb-4">Salvar Música</h3><form id="save-form"><div class="space-y-4"><label for="song-title-input" class="block text-sm mb-1">Título da Música:</label><input type="text" id="song-title-input" class="w-full p-2 border rounded-md" required><label for="original-key-input" class="block text-sm mb-1">Tom Original:</label><input type="text" id="original-key-input" class="w-full p-2 border rounded-md" placeholder="Ex: G, Am, C#m"><div class="flex items-center mt-2"><input id="is-public-checkbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="is-public-checkbox" class="ml-2 block text-sm text-gray-900">Compartilhar com todos os usuários</label></div></div><div class="flex justify-end gap-4 mt-6"><button type="button" class="cancel-btn py-2 px-4 bg-gray-200 rounded-md">Cancelar</button><button type="submit" class="py-2 px-4 bg-blue-600 text-white rounded-md">Salvar</button></div></form></dialog>
    <dialog id="songs-modal" class="p-6 rounded-lg shadow-xl border w-full max-w-lg"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold">Músicas Salvas</h3><button class="cancel-btn text-2xl font-light">&times;</button></div><div class="border-b border-gray-200 mb-2"><nav class="-mb-px flex gap-4" aria-label="Tabs"><button id="my-songs-tab" class="tab-btn active whitespace-nowrap border-b-2 py-2 px-1 text-sm font-medium">Minhas Músicas</button><button id="public-songs-tab" class="tab-btn whitespace-nowrap border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700">Todas as Músicas</button></nav></div><div id="modal-songs-list" class="bg-gray-50 p-2 rounded-md h-96 overflow-y-auto border"></div></dialog>
    <dialog id="setlist-management-modal" class="p-6 rounded-lg shadow-xl border w-full max-w-3xl"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold">Gerenciar Set Lists</h3><button class="cancel-btn text-2xl font-light">&times;</button></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div id="setlist-list-column"></div><div id="setlist-songs-column" class="hidden"></div></div></dialog>
    <dialog id="create-setlist-modal" class="p-6 rounded-lg shadow-xl border w-full max-w-md"><h3 id="create-setlist-modal-title" class="text-lg font-bold mb-4">Criar Novo Set List</h3><form id="create-setlist-form"><label for="setlist-name-input" class="block text-sm mb-1">Nome do Set List:</label><input type="text" id="setlist-name-input" class="w-full p-2 border rounded-md" required><div class="flex justify-end gap-4 mt-6"><button type="button" class="cancel-btn py-2 px-4 bg-gray-200 rounded-md">Cancelar</button><button type="submit" class="py-2 px-4 bg-blue-600 text-white rounded-md">Salvar</button></div></form></dialog>
    <dialog id="add-song-to-setlist-modal" class="p-6 rounded-lg shadow-xl border w-full max-w-lg"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold">Adicionar Música ao Set List</h3><button class="cancel-btn text-2xl font-light">&times;</button></div><div id="add-song-modal-list" class="bg-gray-50 p-2 rounded-md h-96 overflow-y-auto border"></div></dialog>
    <dialog id="user-management-modal" class="p-6 rounded-lg shadow-xl border w-full max-w-lg"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold">Gerenciar Usuários</h3><button id="open-create-user-modal-btn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">Criar Novo</button></div><div id="modal-users-list" class="bg-gray-50 p-2 rounded-md h-80 overflow-y-auto border"></div><div class="flex justify-end mt-4"><button type="button" class="cancel-btn py-2 px-4 bg-gray-200 rounded-md">Fechar</button></div></dialog>
    <dialog id="change-password-modal" class="p-6 rounded-lg shadow-xl border w-full max-w-md"><h3 class="text-lg font-bold mb-4">Alterar Senha</h3><form id="change-password-form"><div class="space-y-4"><label for="old-password" class="block text-sm mb-1">Senha Antiga:</label><input type="password" id="old-password" class="w-full p-2 border rounded-md" required><label for="new-password" class="block text-sm mb-1">Nova Senha:</label><input type="password" id="new-password" class="w-full p-2 border rounded-md" required></div><p id="change-password-feedback" class="text-sm mt-4 hidden"></p><div class="flex justify-end gap-4 mt-6"><button type="button" class="cancel-btn py-2 px-4 bg-gray-200 rounded-md">Cancelar</button><button type="submit" class="py-2 px-4 bg-blue-600 text-white rounded-md">Alterar Senha</button></div></form></dialog>
    <dialog id="create-user-modal" class="p-6 rounded-lg shadow-xl border w-full max-w-md"><h3 class="text-lg font-bold mb-4">Criar Novo Usuário</h3><form id="create-user-form"><div class="space-y-4"><label for="new-username" class="block text-sm mb-1">Nome de Usuário:</label><input type="text" id="new-username" class="w-full p-2 border rounded-md" required><label for="new-password" class="block text-sm mb-1">Senha:</label><input type="password" id="new-password" class="w-full p-2 border rounded-md" required></div><p id="create-user-feedback" class="text-sm mt-4 hidden"></p><div class="flex justify-end gap-4 mt-6"><button type="button" class="cancel-btn py-2 px-4 bg-gray-200 rounded-md">Cancelar</button><button type="submit" class="py-2 px-4 bg-blue-600 text-white rounded-md">Criar Usuário</button></div></form></dialog>

    <script>
    // --- STATE & DOM ---
    const state = { songStructure: [], transposeAmount: 0, currentView: 'chart', isTwoColumns: false, currentSetList: null };
    const dom = { /* ... All DOM elements ... */ }; // Omitted for brevity, but all are captured by their IDs

    // --- All functions (API, Logic, UI, Rendering, Event Handlers) are defined here ---
    // ... This section is large and contains all the application's logic ...

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        // Capture all DOM elements
        Object.keys(state).forEach(key => dom[key] = state[key]);
        const allIds = Array.from(document.querySelectorAll('[id]')).reduce((acc, el) => ({...acc, [el.id.replace(/-/g, '_')]: el }), {});
        Object.assign(dom, allIds);

        // Event Listeners
        dom.loginForm.addEventListener('submit', handleLogin);
        dom.logoutBtn.addEventListener('click', handleLogout);
        dom.generateButton.addEventListener('click', handleGenerate);
        dom.clearInputBtn.addEventListener('click', () => { dom.songInput.value = ''; handleGenerate(); });
        dom.transposeUpBtn.addEventListener('click', () => handleTranspose(1));
        dom.transposeDownBtn.addEventListener('click', () => handleTranspose(-1));
        [dom.lyricsSizeSlider, dom.chordsSizeSlider, dom.lyricsColorPicker, dom.chordsColorPicker].forEach(el => el.addEventListener('input', render));
        dom.viewModeToggle.addEventListener('click', handleViewModeToggle);
        dom.columnsToggle.addEventListener('click', handleColumnsToggle);
        document.querySelectorAll('.view-toggle-btn').forEach(b => b.addEventListener('click', e => handleDeviceViewToggle(e.currentTarget.dataset.view)));
        dom.fullscreenBtn.addEventListener('click', toggleFullscreen);
        document.addEventListener('fullscreenchange', () => dom.appContainer.classList.toggle('fullscreen-view', !!document.fullscreenElement));
        dom.saveButton.addEventListener('click', () => { if (dom.songInput.value.trim()) { dom.saveModal.showModal(); } else { alert("Por favor, cole uma cifra antes de salvar."); } });
        document.querySelectorAll('.cancel-btn').forEach(b => b.addEventListener('click', (e) => e.target.closest('dialog').close()));
        dom.saveForm.addEventListener('submit', handleSaveSong);
        dom.openSongsBtn.addEventListener('click', () => { dom.mySongsTab.click(); dom.songsModal.showModal(); });
        dom.mySongsTab.addEventListener('click', () => { dom.mySongsTab.classList.add('active'); dom.publicSongsTab.classList.remove('active'); loadSavedSongs('my_songs'); });
        dom.publicSongsTab.addEventListener('click', () => { dom.publicSongsTab.classList.add('active'); dom.mySongsTab.classList.remove('active'); loadSavedSongs('public'); });
        dom.manageUsersBtn.addEventListener('click', handleOpenUserManagement);
        dom.modalUsersList.addEventListener('click', handleDeleteUserFromModal);
        dom.openCreateUserModalBtn.addEventListener('click', () => { dom.createUserFeedback.classList.add('hidden'); dom.createUserForm.reset(); dom.createUserModal.showModal(); });
        dom.createUserForm.addEventListener('submit', handleCreateUser);
        dom.changePasswordBtn.addEventListener('click', () => { dom.changePasswordFeedback.classList.add('hidden'); dom.changePasswordForm.reset(); dom.changePasswordModal.showModal(); });
        dom.changePasswordForm.addEventListener('submit', handleChangePassword);
        dom.manageSetlistsBtn.addEventListener('click', handleOpenSetlistManagement);
        dom.createSetlistForm.addEventListener('submit', handleCreateSetList);

        if (dom.songInput.value.trim() === "") { dom.songInput.value = `[Intro]\nG D Em C\n\n[Verso 1]\n   G              D\nVim para adorar-te\n   Em             C\nVim para prostrar-me\nG              D           C\nVim para dizer que és meu Deus`; }
        checkAuthStatus();
    });

    // ... All helper and logic functions would be defined in this script tag ...
    </script>
</body>
</html>